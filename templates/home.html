<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_config.page_titles.home }}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ get_page_description('home') }}">

    <!-- Open Graph / Facebook -->
    {% set embed = get_page_embed('home') %}
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ embed.title }}">
    <meta property="og:description" content="{{ embed.description }}">
    {% if embed.image %}
    <meta property="og:image" content="{{ url_for('static', filename=embed.image, _external=True) }}">
    {% endif %}
    <meta name="theme-color" content="{{ embed.color }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ embed.title }}">
    <meta name="twitter:description" content="{{ embed.description }}">
    {% if embed.image %}
    <meta name="twitter:image" content="{{ url_for('static', filename=embed.image, _external=True) }}">
    {% endif %}

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='responsive.css') }}">
    {% include 'partials/config_styles.html' %}
    {% if session.get('user') %}
    <script src="{{ url_for('static', filename='tab_enforcement.js') }}"></script>
    {% endif %}
    <script>
        window.DB_VERSION = {{ db_version }};
        window.DB_WIPE_MESSAGE = "{{ db_wipe_message }}";
    </script>
    <script src="{{ url_for('static', filename='db_wipe_notice.js') }}"></script>
    <style>
        /* Dynamic fade duration from config */
        .hero-title {
            transition: opacity {{ slideshow_fade_duration }}ms ease !important;
        }
    </style>
</head>
<body>
    <div class="panel">
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-left">
                    <div class="menu-icon" id="menu-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </div>
                    <div class="navbar-text">
                        <h1 class="navbar-title">Ad <span class="gradient-z">Z</span> send</h1>
                        <p class="navbar-subtitle">{{ site_subtitle }}</p>
                    </div>
                </div>
                <div class="nav-right">
                    {% if user %}
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 12px; background: #1A1A1E; padding: 8px 12px; border-radius: 8px; box-shadow: none;">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: #ff3333; flex-shrink: 0;"></div>
                        <span style="color: #dcddde; font-size: 0.9rem;">Welcome!</span>
                        <img src="{{ url_for('static', filename='gear.png') }}" alt="Settings" title="Settings" style="width: 14px; height: 14px; cursor: pointer; filter: brightness(0) saturate(100%) invert(56%) sepia(6%) saturate(340%) hue-rotate(194deg) brightness(93%) contrast(87%);" onclick="openSettings()">
                    </div>
                    {% elif not session.get('user') %}
                        <div class="auth-buttons">
                            <a href="{{ url_for('login_page') }}" class="auth-btn login-btn">{{ auth_labels.login }}</a>
                            <a href="{{ url_for('signup_page') }}" class="auth-btn signup-btn">{{ auth_labels.signup }}</a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="{{ url_for('home') }}" class="dropdown-item">{{ nav_labels.home }}</a>
                <a href="{{ url_for('purchase') }}" class="dropdown-item">{{ nav_labels.purchase }}</a>
                {% if session.get('user') %}
                    {% if not (plan_status and plan_status.plan_id and plan_status.plan_id.startswith('team_plan_')) %}
                        <a href="{{ url_for('panel') }}" class="dropdown-item">{{ nav_labels.panel }}</a>
                    {% endif %}
                    {% if has_business %}
                    {% if is_owner %}
                    <a href="{{ url_for('team_management') }}" class="dropdown-item">{{ nav_labels.team_management }}</a>
                    {% endif %}
                    <a href="{{ url_for('team_panel') }}" class="dropdown-item">{{ nav_labels.team_panel }}</a>
                    {% endif %}
                    <a href="{{ url_for('settings') }}" class="dropdown-item">{{ nav_labels.settings }}</a>
                    {% if is_admin_user %}
                    <a href="{{ url_for('admin_panel') }}" class="dropdown-item">{{ nav_labels.admin }}</a>
                    {% endif %}
                {% endif %}
                <div class="dropdown-divider"></div>
                <a href="{{ discord_invite_url }}" target="_blank" class="dropdown-item discord-item">{{ nav_labels.discord }}</a>
                {% if session.get('user') %}
                    <a href="{{ url_for('logout') }}" class="dropdown-item logout-item">{{ nav_labels.logout }}</a>
                {% endif %}
            </div>
        </nav>

        <div class="panel-container">
            <div class="home-content">
                <div class="hero-section">
                    <!-- Hero Heading Section -->
                    <div class="hero-heading">
                        <h1 class="hero-brand">Ad<span class="gradient-z">Z</span>send</h1>
                        <p class="hero-tagline">The Ultimate <span class="teal-gradient">Discord Marketing System</span></p>
                        <div class="hero-divider"></div>
                    </div>

                    <!-- Hero title -->
                    <h2 class="hero-title" id="hero-title">{{ slideshow_messages[0] }}</h2>

                    <!-- CTA Buttons -->
                    <div class="hero-buttons">
                        <a href="https://discord.gg/" class="discord-btn"><img src="{{ url_for('static', filename='discordlogo.png') }}" alt="Discord" class="discord-btn-icon">Our Discord server</a>
                        <a href="{{ url_for('purchase') }}" class="view-pricing-btn">{{ hero_cta_button_text }}</a>
                    </div>

                    <!-- Panel Images - 3 images with rotation -->
                    <div class="hero-panel-images">
                        <div class="hero-panel-image hero-panel-left" onclick="openLightbox(0)">
                            <img src="{{ url_for('static', filename=hero_panel_images[0]) }}" alt="Panel Preview">
                        </div>
                        <div class="hero-panel-image hero-panel-center" onclick="openLightbox(1)">
                            <img src="{{ url_for('static', filename=hero_panel_images[1]) }}" alt="Panel Preview">
                        </div>
                        <div class="hero-panel-image hero-panel-right" onclick="openLightbox(2)">
                            <img src="{{ url_for('static', filename=hero_panel_images[2]) }}" alt="Panel Preview">
                        </div>
                    </div>

                    <!-- Scroll Indicator -->
                    <div class="scroll-indicator" id="scroll-indicator">
                        <span class="scroll-text">{{ scroll_indicator_text }}</span>
                        <div class="scroll-arrow">&#8595;</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <section class="about-section">
            <h2 class="about-title">{{ about_title }}</h2>
            <p class="about-description">{{ about_description }}</p>
        </section>

        <!-- Why Discord Section -->
        <section class="why-discord-section">
            <!-- Wumpus Character - at top edge -->
            <div class="wumpus-container">
                <div class="wumpus-character">
                    <div class="wumpus-leaf">
                        <img src="{{ url_for('static', filename='WumpusLeaf.png') }}" alt="Leaf">
                    </div>
                    <img src="{{ url_for('static', filename='WumpusDiscord.png') }}" alt="Wumpus">
                </div>
            </div>

            <h2 class="why-discord-title">{{ why_discord_title }}</h2>

            <!-- Discord Branding - Logo only -->
            <div class="discord-branding">
                <img src="{{ url_for('static', filename='DiscordLogo.png') }}" alt="Discord Logo" class="discord-logo">
            </div>

            <!-- Discord Stats -->
            <div class="discord-stats">
                {% for stat in why_discord_stats %}
                <div class="discord-stat-item">
                    <div class="stat-number" data-target="{{ stat.value }}">0</div>
                    <div class="stat-label">{{ stat.label }}</div>
                </div>
                {% endfor %}
            </div>

            <!-- Benefits Grid -->
            <div class="discord-benefits-grid">
                {% for benefit in why_discord_benefits %}
                <div class="benefit-card">
                    <h3 class="benefit-title">{{ benefit.title }}</h3>
                    <p class="benefit-description">{{ benefit.description }}</p>
                </div>
                {% endfor %}
            </div>

            <!-- Large Wordmark at bottom -->
            <img src="{{ url_for('static', filename='Wordmark.svg') }}" alt="Discord" class="discord-wordmark-bottom">
        </section>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightboxOnBackground(event)">
        <!-- Close button - fixed position at top -->
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>

        <!-- Main content wrapper -->
        <div class="lightbox-content">
            <button class="lightbox-nav lightbox-prev" onclick="prevImage(event)">&larr;</button>
            <div class="lightbox-image-wrapper">
                <img id="lightbox-img" src="" alt="Panel Screenshot">
            </div>
            <button class="lightbox-nav lightbox-next" onclick="nextImage(event)">&rarr;</button>
        </div>

        <!-- Counter - fixed position at bottom center -->
        <div class="lightbox-counter">
            <span id="current-index">1</span> / <span id="total-images">3</span>
        </div>
    </div>

    <script>
        // Dropdown menu toggle
        const menuIcon = document.getElementById('menu-icon');
        const dropdownMenu = document.getElementById('dropdown-menu');

        if (menuIcon) {
            menuIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!dropdownMenu.contains(e.target) && !menuIcon.contains(e.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        // Hero text slideshow - uses requestAnimationFrame for background-safe timing
        const heroTitle = document.getElementById('hero-title');
        const messages = {{ slideshow_messages | tojson }};
        const interval = {{ slideshow_interval }};
        const fadeDuration = {{ slideshow_fade_duration }};
        let currentIndex = 0;
        let lastSlideTime = Date.now();

        function changeSlide() {
            // Fade out
            heroTitle.classList.add('fade-out');

            setTimeout(() => {
                // Change text
                currentIndex = (currentIndex + 1) % messages.length;
                heroTitle.textContent = messages[currentIndex];

                // Fade in
                heroTitle.classList.remove('fade-out');
                heroTitle.classList.add('fade-in');

                setTimeout(() => {
                    heroTitle.classList.remove('fade-in');
                }, fadeDuration);
            }, fadeDuration);
        }

        // Use requestAnimationFrame for smooth background-safe slideshow
        function slideshowLoop() {
            const now = Date.now();
            if (now - lastSlideTime >= interval) {
                changeSlide();
                lastSlideTime = now;
            }
            requestAnimationFrame(slideshowLoop);
        }

        // Start slideshow
        requestAnimationFrame(slideshowLoop);

        // Pause leaf animation when tab is hidden (matches slideshow behavior)
        const wumpusLeaf = document.querySelector('.wumpus-leaf');
        if (wumpusLeaf) {
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    wumpusLeaf.style.animationPlayState = 'paused';
                } else {
                    wumpusLeaf.style.animationPlayState = 'running';
                }
            });
        }

        // Scroll indicator visibility
        const scrollIndicator = document.getElementById('scroll-indicator');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                scrollIndicator.classList.add('hidden');
            } else {
                scrollIndicator.classList.remove('hidden');
            }
        });

        // About section fade-in on scroll
        const aboutSection = document.querySelector('.about-section');
        if (aboutSection) {
            const aboutObserver = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        aboutObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });

            aboutObserver.observe(aboutSection);
        }

        // Lightbox for hero panel images
        const images = [
            '{{ url_for('static', filename=hero_panel_images[0]) }}',
            '{{ url_for('static', filename=hero_panel_images[1]) }}',
            '{{ url_for('static', filename=hero_panel_images[2]) }}'
        ];
        let currentImageIndex = 0;

        function openLightbox(index) {
            currentImageIndex = index;
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            lightboxImg.src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeLightboxOnBackground(event) {
            if (event.target.id === 'lightbox') {
                closeLightbox();
            }
        }

        function prevImage(event) {
            event.stopPropagation();
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            document.getElementById('lightbox-img').src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
        }

        function nextImage(event) {
            event.stopPropagation();
            currentImageIndex = (currentImageIndex + 1) % images.length;
            document.getElementById('lightbox-img').src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
        }

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', function(event) {
            const lightbox = document.getElementById('lightbox');
            if (!lightbox.classList.contains('active')) return;

            if (event.key === 'Escape') closeLightbox();
            if (event.key === 'ArrowLeft') prevImage(event);
            if (event.key === 'ArrowRight') nextImage(event);
        });

        // Count-up animation for Discord stats (multiple items)
        (function() {
            const statNumbers = document.querySelectorAll('.stat-number[data-target]');
            if (statNumbers.length === 0) return;

            statNumbers.forEach(function(statNumber) {
                let hasAnimated = false;
                const targetValue = statNumber.dataset.target; // e.g., "250M+"

                // Parse the numeric part and suffix
                const match = targetValue.match(/^(\d+(?:\.\d+)?)(.*)/);
                if (!match) {
                    statNumber.textContent = targetValue;
                    return;
                }

                const numericValue = parseFloat(match[1]);
                const suffix = match[2]; // e.g., "M+"

                function animateCount() {
                    if (hasAnimated) return;
                    hasAnimated = true;

                    const duration = 1800; // 1.8 seconds for smoother animation
                    const startTime = performance.now();

                    function update(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);

                        // Smooth ease-out with less aggressive deceleration
                        const easeOut = 1 - Math.pow(1 - progress, 2);
                        const currentValue = Math.round(numericValue * easeOut);

                        statNumber.textContent = currentValue + suffix;

                        if (progress < 1) {
                            requestAnimationFrame(update);
                        } else {
                            statNumber.textContent = targetValue; // Ensure final value is exact
                        }
                    }

                    requestAnimationFrame(update);
                }

                // Use Intersection Observer to trigger animation when visible
                const observer = new IntersectionObserver(function(entries) {
                    entries.forEach(function(entry) {
                        if (entry.isIntersecting) {
                            animateCount();
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.5 }); // Trigger when 50% visible

                observer.observe(statNumber);
            });
        })();
    </script>

    {% include 'partials/settings_popup.html' %}
</body>
</html>
