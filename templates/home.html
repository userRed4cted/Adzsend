<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_config.page_titles.home }}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ get_page_description('home') }}">

    <!-- Open Graph / Facebook -->
    {% set embed = get_page_embed('home') %}
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ embed.title }}">
    <meta property="og:description" content="{{ embed.description }}">
    {% if embed.image %}
    <meta property="og:image" content="{{ url_for('static', filename=embed.image, _external=True) }}">
    {% endif %}
    <meta name="theme-color" content="{{ embed.color }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ embed.title }}">
    <meta name="twitter:description" content="{{ embed.description }}">
    {% if embed.image %}
    <meta name="twitter:image" content="{{ url_for('static', filename=embed.image, _external=True) }}">
    {% endif %}

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='responsive.css') }}">
    {% include 'partials/config_styles.html' %}
    {% if session.get('user') %}
    <script src="{{ url_for('static', filename='tab_enforcement.js') }}"></script>
    {% endif %}
    <script>
        window.DB_VERSION = {{ db_version }};
        window.DB_WIPE_MESSAGE = "{{ db_wipe_message }}";
    </script>
    <script src="{{ url_for('static', filename='db_wipe_notice.js') }}"></script>
    <script src="{{ url_for('static', filename='custom_popup.js') }}"></script>
    {% include 'partials/base_scripts.html' %}
    <style>
        /* Dynamic fade duration from config */
        .hero-title.fade-out,
        .hero-title.fade-in {
            transition: opacity {{ slideshow_fade_duration }}ms ease !important;
        }

        /* ABC Ginto Nord font for Discord Marketing System */
        @font-face {
            font-family: 'ABC Ginto Nord';
            src: url('{{ url_for("static", filename="fonts/ABCGintoNord-Black-Trial.otf") }}') format('opentype');
        }

        .hero-tagline .teal-gradient {
            font-family: 'ABC Ginto Nord', 'gg sans', 'Noto Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #121215;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        .page-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .page-scroll-container {
            flex: 1;
            overflow-y: auto;
            padding-top: 60px;
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        {% include 'navbar.html' %}

        <div class="page-scroll-container">
            <div class="home-content">
                <div class="hero-section">
                    <!-- Hero Heading Section -->
                    <div class="hero-heading">
                        <div class="hero-tagline-wrapper hero-fade-in" style="animation-delay: 0s;">
                            <p class="hero-tagline">The Ultimate <span class="teal-gradient">Discord Marketing System</span></p>
                            <div class="hero-divider"></div>
                        </div>
                    </div>

                    <!-- Hero title -->
                    <h2 class="hero-title hero-fade-in" id="hero-title" style="animation-delay: 0.3s;">{{ slideshow_messages[0] }}</h2>

                    <!-- CTA Buttons -->
                    <div class="hero-buttons hero-fade-in" style="animation-delay: 0.6s;">
                        <a href="{{ discord_server_url }}" target="_blank" class="discord-btn"><img src="{{ url_for('static', filename='discordlogo.png') }}" alt="Discord" class="discord-btn-icon">Our Discord server</a>
                        <a href="{{ url_for('purchase') }}" class="view-pricing-btn">{{ hero_cta_button_text }}</a>
                    </div>

                    <!-- Panel Images - 3 images with rotation -->
                    <div class="hero-panel-images hero-fade-in" style="animation-delay: 0.9s;">
                        <div class="hero-panel-image hero-panel-left" onclick="openPanelLightbox(0)">
                            <img src="{{ url_for('static', filename=hero_panel_images[0]) }}" alt="Panel Preview">
                        </div>
                        <div class="hero-panel-image hero-panel-center" onclick="openPanelLightbox(1)">
                            <img src="{{ url_for('static', filename=hero_panel_images[1]) }}" alt="Panel Preview">
                        </div>
                        <div class="hero-panel-image hero-panel-right" onclick="openPanelLightbox(2)">
                            <img src="{{ url_for('static', filename=hero_panel_images[2]) }}" alt="Panel Preview">
                        </div>
                    </div>

                </div>
            </div>

            <!-- Why Discord Section -->
            <section class="why-discord-section">
            <!-- Wumpus Character - at top edge -->
            <div class="wumpus-container">
                <div class="wumpus-character">
                    <div class="wumpus-leaf">
                        <img src="{{ url_for('static', filename='WumpusLeaf.png') }}" alt="Leaf">
                    </div>
                    <img src="{{ url_for('static', filename='WumpusDiscord.png') }}" alt="Wumpus">
                </div>
            </div>

            <h2 class="why-discord-title">{{ why_discord_title }}</h2>

            <!-- Discord Branding - Logo only -->
            <div class="discord-branding">
                <img src="{{ url_for('static', filename='DiscordLogo.png') }}" alt="Discord Logo" class="discord-logo">
            </div>

            <!-- Discord Stats -->
            <div class="discord-stats">
                {% for stat in why_discord_stats %}
                <div class="discord-stat-item">
                    <div class="stat-number" data-target="{{ stat.value }}">0</div>
                    <div class="stat-label">{{ stat.label }}</div>
                </div>
                {% endfor %}
            </div>

            <!-- Benefits Grid -->
            <div class="discord-benefits-grid">
                {% for benefit in why_discord_benefits %}
                <div class="benefit-card">
                    <h3 class="benefit-title">{{ benefit.title }}</h3>
                    <p class="benefit-description">{{ benefit.description }}</p>
                </div>
                {% endfor %}
            </div>

            <!-- Large Wordmark at bottom -->
            <img src="{{ url_for('static', filename='Wordmark.svg') }}" alt="Discord" class="discord-wordmark-bottom">
        </section>

            {% include 'partials/footer.html' %}
        </div>
    </div>

    <script>
        // Remove will-change after initial animations complete
        requestAnimationFrame(() => {
            setTimeout(() => {
                document.querySelectorAll('.hero-fade-in').forEach(el => {
                    el.style.willChange = 'auto';
                });
            }, 2200); // Last element: 1.2s delay + 1s animation
        });

        // Hero text slideshow - optimized with CSS transitions only
        const heroTitle = document.getElementById('hero-title');
        const messages = {{ slideshow_messages | tojson }};
        const interval = {{ slideshow_interval }};
        const fadeDuration = {{ slideshow_fade_duration }};
        let currentIndex = 0;
        let lastSlideTime = performance.now();
        let rafId;

        // Remove hero-fade-in class after initial animation and set up smooth transition
        setTimeout(() => {
            heroTitle.classList.remove('hero-fade-in');
            heroTitle.style.willChange = 'auto';
            // Set transition dynamically to match configured fade duration (like navbar profile)
            heroTitle.style.transition = `opacity ${fadeDuration}ms ease`;
        }, 1300); // 0.3s delay + 1s animation

        function changeSlide() {
            // Fade out smoothly
            heroTitle.style.opacity = '0';

            // Wait for fade-out to complete, then change text and fade in
            setTimeout(() => {
                // Change text during invisible state
                currentIndex = (currentIndex + 1) % messages.length;
                heroTitle.textContent = messages[currentIndex];

                // Fade back in
                heroTitle.style.opacity = '1';
            }, fadeDuration);
        }

        // Optimized slideshow loop with proper RAF usage
        function slideshowLoop(currentTime) {
            if (currentTime - lastSlideTime >= interval) {
                changeSlide();
                lastSlideTime = currentTime;
            }
            rafId = requestAnimationFrame(slideshowLoop);
        }

        // Start slideshow
        rafId = requestAnimationFrame(slideshowLoop);

        // Stop slideshow when tab is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (rafId) cancelAnimationFrame(rafId);
            } else {
                lastSlideTime = performance.now();
                rafId = requestAnimationFrame(slideshowLoop);
            }
        }, { passive: true });

        // Panel images for lightbox - uses unified lightbox system
        const panelImages = [
            '{{ url_for('static', filename=hero_panel_images[0]) }}',
            '{{ url_for('static', filename=hero_panel_images[1]) }}',
            '{{ url_for('static', filename=hero_panel_images[2]) }}'
        ];

        function openPanelLightbox(index) {
            openImageLightbox(panelImages, index);
        }

        // Count-up animation for Discord stats - optimized version
        (() => {
            const statNumbers = document.querySelectorAll('.stat-number[data-target]');
            if (statNumbers.length === 0) return;

            statNumbers.forEach(statNumber => {
                let hasAnimated = false;
                const targetValue = statNumber.dataset.target;

                // Parse numeric part and suffix
                const match = targetValue.match(/^(\d+(?:\.\d+)?)(.*)/);
                if (!match) {
                    statNumber.textContent = targetValue;
                    return;
                }

                const numericValue = parseFloat(match[1]);
                const suffix = match[2];

                // Pre-calculate step size for better performance
                const steps = 60; // 60 updates total
                const stepValue = numericValue / steps;

                function animateCount() {
                    if (hasAnimated) return;
                    hasAnimated = true;

                    // Enable GPU acceleration for this element
                    statNumber.style.willChange = 'contents';

                    const duration = 1200;
                    const startTime = performance.now();
                    let lastUpdate = 0;

                    function update(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);

                        // Ease-out curve
                        const easeOut = 1 - Math.pow(1 - progress, 2);
                        const currentValue = Math.round(numericValue * easeOut);

                        // Only update if value changed (reduces reflows)
                        if (currentValue !== lastUpdate) {
                            statNumber.textContent = currentValue + suffix;
                            lastUpdate = currentValue;
                        }

                        if (progress < 1) {
                            requestAnimationFrame(update);
                        } else {
                            statNumber.textContent = targetValue;
                            // Remove will-change after animation
                            statNumber.style.willChange = 'auto';
                        }
                    }

                    requestAnimationFrame(update);
                }

                // Use IntersectionObserver for efficient visibility detection
                const observer = new IntersectionObserver(
                    (entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                // Schedule animation for next idle period
                                requestIdleCallback(() => {
                                    animateCount();
                                }, { timeout: 500 });
                                observer.unobserve(entry.target);
                            }
                        });
                    },
                    {
                        threshold: 0.3,
                        rootMargin: '100px'
                    }
                );

                observer.observe(statNumber);
            });
        })();
    </script>

    {% include 'partials/settings_popup.html' %}
</body>
</html>
