<nav class="navbar">
    <div class="navbar-content">
        <div class="navbar-left">
            <a href="{{ url_for('home') }}" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
                <img src="/static/favicon.png" alt="Logo" style="width: 51px; height: 51px; display: block; object-fit: contain;" loading="eager">
                <h1 class="navbar-title">Ad <span class="gradient-z">Z</span> send</h1>
            </a>
        </div>
        <div class="nav-right">
            <!-- Navigation Links -->
            <nav class="nav-links">
                <a href="{{ url_for('home') }}" class="nav-link" data-page="home">Home</a>
                <a href="{{ url_for('purchase') }}" class="nav-link" data-page="purchase">Purchase</a>
                <a href="{{ url_for('discover') }}" class="nav-link" data-page="discover">Discover</a>
                <a href="{{ url_for('dashboard') if user else '#' }}" class="nav-link{% if not user %} disabled{% endif %}" data-page="dashboard"{% if not user %} onclick="return false;"{% endif %}>Dashboard</a>
                <a href="{{ url_for('support') }}" class="nav-link" data-page="support">Support</a>
            </nav>

            <!-- User Profile / Auth Buttons -->
            <div class="navbar-profile-container">
                {% if user %}
                <div class="navbar-profile-circle">
                    <img src="{{ url_for('static', filename='profile_photos/' ~ (user_data.profile_photo if user_data and user_data.profile_photo else 'Light_Blue.jpg')) }}" alt="Profile" class="user-profile-photo">
                </div>
                <span class="navbar-welcome-text">Welcome!</span>
                <img src="{{ url_for('static', filename='gear.png') }}" alt="Settings" title="Settings" class="navbar-settings-icon" onclick="openSettings()">
                {% else %}
                <a href="{{ url_for('signup_page') }}" class="navbar-auth-link">Sign up</a>
                <a href="{{ url_for('login_page') }}" class="navbar-auth-link">Login</a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<script>
// Detect active page and mark navigation link
(function() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
        const page = link.getAttribute('data-page');

        // Check if current path matches this link
        let isActive = false;

        if (page === 'home' && (currentPath === '/' || currentPath === '/home')) {
            isActive = true;
        } else if (page === 'purchase' && currentPath.startsWith('/purchase')) {
            isActive = true;
        } else if (page === 'discover' && currentPath.startsWith('/discover')) {
            isActive = true;
        } else if (page === 'dashboard' && currentPath.startsWith('/dashboard')) {
            isActive = true;
        } else if (page === 'support' && currentPath.startsWith('/support')) {
            isActive = true;
        }

        if (isActive) {
            link.classList.add('active');
        }
    });
})();

// Logo retry on fail
(function() {
    const logoImg = document.querySelector('.navbar-left img[src*="favicon.png"]');
    if (logoImg) {
        logoImg.addEventListener('error', function() {
            // Retry after 1 second
            setTimeout(() => {
                const currentSrc = logoImg.src;
                logoImg.src = '';
                logoImg.src = currentSrc + '?retry=' + Date.now();
            }, 1000);
        });
    }
})();
</script>
